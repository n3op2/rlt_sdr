{"ast":null,"code":"var _jsxFileName = \"/home/n3op2/node/sdrf_client/src/App.js\";\nimport React, { Fragment, useEffect } from 'react';\nimport * as d3 from 'd3';\nimport axios from 'axios';\n\nconst Heatmap = () => {\n  useEffect(() => {\n    const url = 'http://localhost:3010';\n    axios.get(url).then(res => {\n      console.log('fetching data...'); // TODO have a separate table for data values such as\n      // hzLow, hzHigh and link it with freqs id\n\n      if (res.data) {\n        const data = res.data;\n        const baseFq = res.data[0].hzLow;\n        const baseTemperature = res.data[0].hzLow;\n        const timeRange = d3.extent(data, d => d.createdAt);\n        const step = res.data.step;\n        const mappedData = data.map(el => {\n          const tmp = {};\n          let tmpFq = baseFq;\n          return el.freqs.map(fq => {\n            tmp.freq = tmpFq;\n            tmpFq += step;\n          });\n        });\n      } else {\n        console.log('empty response');\n      }\n    });\n    /*\n    const legendData = [\n      {'interval': -127, 'color': 'purple'},\n      {'interval': -65, 'color': 'darkorchid'},\n      {'interval': 0, 'color': 'mediumpurple'},\n      {'interval': 65, 'color': 'lightskyblue'},\n      {'interval': 127, 'color': 'khaki'}\n    ];\n    \n    const width = 917,\n          height = 408,\n          margins = {top:20, right: 50, bottom: 100, left: 100};\n    \n    const yScale = d3.scaleLinear()\n      .range([height,0])\n      .domain([12,0]);\n    \n    const xScale = d3.scaleLinear()\n      .range([0,width])\n      .domain(d3.extent(data, d => {return d.createdAt; }));\n    \n    //Setting chart width and adjusting for margins\n    const chart = d3.select('.chart')\n      .attr('width', width + margins.right + margins.left)\n      .attr('height', height + margins.top + margins.bottom)\n      .append('g')\n      .attr('transform','translate(' + margins.left + ',' + margins.top + ')');\n    \n    const tooltip = d3.select('.container').append('div')\n      .attr('class','tooltip')\n      .html('Tooltip')\n    \n    const barWidth = width / (yearRange[1] - yearRange[0]),\n          barHeight = height / 12;\n    \n    //Return dynamic color based on intervals in legendData\n    const colorScale = d => {\n      for (let i = 0; i < legendData.length; i++) {\n        if (d.db + baseTemperature < legendData[i].interval) {\n          return legendData[i].color;\n        }\n      }\n      return 'darkred';\n    };\n    \n    //Return abbreviate month string from month decimal\n    const timeParseFormat = d => {\n      if (d === 0) return '';\n      return d3.timeFormat('%b')(d3.timeParse('%m')(d));\n    };\n    \n    //Append heatmap bars, styles, and mouse events\n    chart.selectAll('g')\n      .data(data).enter().append('g')\n      .append('rect')\n      .attr('x', d => {return (d.freq - timeRange[0]) * barWidth})\n      .attr('y', d => {return (d.createdAt - 1) * barHeight})\n      .style('fill', colorScale)\n      .attr('width', barWidth)\n      .attr('height', barHeight)\n      .on('mouseover', d => {\n        tooltip.html(timeParseFormat(d.month) + ' ' + d.year + '<br/>' +\n          d3.format('.4r')(baseTemperature + d.variance) + ' &degC<br/>' + d.variance + ' &degC' )\n          .style('left', d3.event.pageX - 35 + 'px')\n          .style('top', d3.event.pageY - 73 + 'px')\n          .style('opacity', .9);\n      }).on('mouseout', () => {\n        tooltip.style('opacity', 0)\n          .style('left', '0px');\n      });\n    \n    //Append x axis\n    chart.append('g')\n      .attr('transform','translate(0,' + height + ')')\n      .call(d3.axisBottom(xScale).tickFormat(d3.format('.4')));\n    \n    //Append y axis\n    chart.append('g')\n      .attr('transform','translate(0,-' + barHeight / 2 + ')')\n      .call(d3.axisLeft(yScale).tickFormat(timeParseFormat))\n      .attr('class','yAxis');\n    \n    //Append y axis label\n    chart.append('text')\n      .attr('transform','translate(-40,' + (height / 2)  + ') rotate(-90)')\n      .style('text-anchor','middle')\n      .text('Month');\n    \n    //Append x axis label\n    chart.append('text')\n      .attr('transform','translate(' + (width / 2) + ',' + (height + 40) + ')')\n      .style('text-anchor','middle')\n      .text('Year');\n    \n    //Append color legend using legendData\n    chart.append('g')\n      .selectAll('g')\n      .data(legendData).enter()\n      .append('rect')\n      .attr('width', 30)\n      .attr('height', 20)\n      .attr('x', (d, i) => { return i * 30 + width * .7;})\n      .attr('y', height + margins.top)\n      .style('fill', d => {return d.color; });\n    \n    //Append text labels for legend from legendData\n    chart.append('g')\n      .selectAll('text')\n      .data(legendData).enter().append('text')\n      .attr('x', (d,i) => {return i * 30 + width * .7})\n      .attr('y', height + margins.top * 3)\n      .text(d => {return d.interval; });\n      \n    });\n    */\n  }, []);\n  return React.createElement(Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151\n    },\n    __self: this\n  }, React.createElement(\"h1\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152\n    },\n    __self: this\n  }, \"Heatmap\"));\n};\n\nconst App = () => {\n  return React.createElement(\"div\", {\n    className: \"App\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159\n    },\n    __self: this\n  }, React.createElement(Heatmap, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160\n    },\n    __self: this\n  }));\n};\n\nexport default App;","map":{"version":3,"sources":["/home/n3op2/node/sdrf_client/src/App.js"],"names":["React","Fragment","useEffect","d3","axios","Heatmap","url","get","then","res","console","log","data","baseFq","hzLow","baseTemperature","timeRange","extent","d","createdAt","step","mappedData","map","el","tmp","tmpFq","freqs","fq","freq","App"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA2C,OAA3C;AACA,OAAO,KAAKC,EAAZ,MAAoB,IAApB;AACA,OAAOC,KAAP,MAAkB,OAAlB;;AAEA,MAAMC,OAAO,GAAG,MAAM;AACpBH,EAAAA,SAAS,CAAC,MAAM;AACd,UAAMI,GAAG,GAAG,uBAAZ;AACAF,IAAAA,KAAK,CAACG,GAAN,CAAUD,GAAV,EAAeE,IAAf,CAAoBC,GAAG,IAAI;AACzBC,MAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EADyB,CAEzB;AACA;;AACA,UAAIF,GAAG,CAACG,IAAR,EAAc;AACZ,cAAMA,IAAI,GAAGH,GAAG,CAACG,IAAjB;AACA,cAAMC,MAAM,GAAGJ,GAAG,CAACG,IAAJ,CAAS,CAAT,EAAYE,KAA3B;AACA,cAAMC,eAAe,GAAGN,GAAG,CAACG,IAAJ,CAAS,CAAT,EAAYE,KAApC;AACA,cAAME,SAAS,GAAGb,EAAE,CAACc,MAAH,CAAUL,IAAV,EAAgBM,CAAC,IAAIA,CAAC,CAACC,SAAvB,CAAlB;AACA,cAAMC,IAAI,GAAGX,GAAG,CAACG,IAAJ,CAASQ,IAAtB;AAEA,cAAMC,UAAU,GAAGT,IAAI,CAACU,GAAL,CAAUC,EAAD,IAAQ;AAClC,gBAAMC,GAAG,GAAG,EAAZ;AACA,cAAIC,KAAK,GAAGZ,MAAZ;AACA,iBAAOU,EAAE,CAACG,KAAH,CAASJ,GAAT,CAAcK,EAAD,IAAQ;AAC1BH,YAAAA,GAAG,CAACI,IAAJ,GAAWH,KAAX;AACAA,YAAAA,KAAK,IAAIL,IAAT;AACD,WAHM,CAAP;AAID,SAPkB,CAAnB;AAQD,OAfD,MAeO;AACLV,QAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ;AACD;AACF,KAtBD;AAwBE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoHH,GA9IQ,EA8IN,EA9IM,CAAT;AAgJA,SACE,oBAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eADF,CADF;AAKD,CAtJD;;AAwJA,MAAMkB,GAAG,GAAG,MAAM;AAChB,SACE;AAAK,IAAA,SAAS,EAAC,KAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,OAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CADF;AAKD,CAND;;AAQA,eAAeA,GAAf","sourcesContent":["import React, { Fragment, useEffect } from 'react';\nimport * as d3 from 'd3';\nimport axios from 'axios';\n\nconst Heatmap = () => {\n  useEffect(() => {\n    const url = 'http://localhost:3010';\n    axios.get(url).then(res => {\n      console.log('fetching data...');\n      // TODO have a separate table for data values such as\n      // hzLow, hzHigh and link it with freqs id\n      if (res.data) {\n        const data = res.data;\n        const baseFq = res.data[0].hzLow;\n        const baseTemperature = res.data[0].hzLow;\n        const timeRange = d3.extent(data, d => d.createdAt);\n        const step = res.data.step;\n\n        const mappedData = data.map((el) => {\n          const tmp = {};\n          let tmpFq = baseFq;\n          return el.freqs.map((fq) => {\n            tmp.freq = tmpFq;\n            tmpFq += step;\n          });\n        });\n      } else {\n        console.log('empty response');\n      }\n    });\n\n      /*\n      const legendData = [\n        {'interval': -127, 'color': 'purple'},\n        {'interval': -65, 'color': 'darkorchid'},\n        {'interval': 0, 'color': 'mediumpurple'},\n        {'interval': 65, 'color': 'lightskyblue'},\n        {'interval': 127, 'color': 'khaki'}\n      ];\n      \n      const width = 917,\n            height = 408,\n            margins = {top:20, right: 50, bottom: 100, left: 100};\n      \n      const yScale = d3.scaleLinear()\n        .range([height,0])\n        .domain([12,0]);\n      \n      const xScale = d3.scaleLinear()\n        .range([0,width])\n        .domain(d3.extent(data, d => {return d.createdAt; }));\n      \n      //Setting chart width and adjusting for margins\n      const chart = d3.select('.chart')\n        .attr('width', width + margins.right + margins.left)\n        .attr('height', height + margins.top + margins.bottom)\n        .append('g')\n        .attr('transform','translate(' + margins.left + ',' + margins.top + ')');\n      \n      const tooltip = d3.select('.container').append('div')\n        .attr('class','tooltip')\n        .html('Tooltip')\n      \n      const barWidth = width / (yearRange[1] - yearRange[0]),\n            barHeight = height / 12;\n      \n      //Return dynamic color based on intervals in legendData\n      const colorScale = d => {\n        for (let i = 0; i < legendData.length; i++) {\n          if (d.db + baseTemperature < legendData[i].interval) {\n            return legendData[i].color;\n          }\n        }\n        return 'darkred';\n      };\n      \n      //Return abbreviate month string from month decimal\n      const timeParseFormat = d => {\n        if (d === 0) return '';\n        return d3.timeFormat('%b')(d3.timeParse('%m')(d));\n      };\n      \n      //Append heatmap bars, styles, and mouse events\n      chart.selectAll('g')\n        .data(data).enter().append('g')\n        .append('rect')\n        .attr('x', d => {return (d.freq - timeRange[0]) * barWidth})\n        .attr('y', d => {return (d.createdAt - 1) * barHeight})\n        .style('fill', colorScale)\n        .attr('width', barWidth)\n        .attr('height', barHeight)\n        .on('mouseover', d => {\n          tooltip.html(timeParseFormat(d.month) + ' ' + d.year + '<br/>' +\n            d3.format('.4r')(baseTemperature + d.variance) + ' &degC<br/>' + d.variance + ' &degC' )\n            .style('left', d3.event.pageX - 35 + 'px')\n            .style('top', d3.event.pageY - 73 + 'px')\n            .style('opacity', .9);\n        }).on('mouseout', () => {\n          tooltip.style('opacity', 0)\n            .style('left', '0px');\n        });\n      \n      //Append x axis\n      chart.append('g')\n        .attr('transform','translate(0,' + height + ')')\n        .call(d3.axisBottom(xScale).tickFormat(d3.format('.4')));\n      \n      //Append y axis\n      chart.append('g')\n        .attr('transform','translate(0,-' + barHeight / 2 + ')')\n        .call(d3.axisLeft(yScale).tickFormat(timeParseFormat))\n        .attr('class','yAxis');\n      \n      //Append y axis label\n      chart.append('text')\n        .attr('transform','translate(-40,' + (height / 2)  + ') rotate(-90)')\n        .style('text-anchor','middle')\n        .text('Month');\n      \n      //Append x axis label\n      chart.append('text')\n        .attr('transform','translate(' + (width / 2) + ',' + (height + 40) + ')')\n        .style('text-anchor','middle')\n        .text('Year');\n      \n      //Append color legend using legendData\n      chart.append('g')\n        .selectAll('g')\n        .data(legendData).enter()\n        .append('rect')\n        .attr('width', 30)\n        .attr('height', 20)\n        .attr('x', (d, i) => { return i * 30 + width * .7;})\n        .attr('y', height + margins.top)\n        .style('fill', d => {return d.color; });\n      \n      //Append text labels for legend from legendData\n      chart.append('g')\n        .selectAll('text')\n        .data(legendData).enter().append('text')\n        .attr('x', (d,i) => {return i * 30 + width * .7})\n        .attr('y', height + margins.top * 3)\n        .text(d => {return d.interval; });\n        \n    });\n    */ \n\n  }, []);\n\n  return (\n    <Fragment>\n      <h1>Heatmap</h1>\n    </Fragment>\n  );\n};\n\nconst App = () => {\n  return (\n    <div className=\"App\">\n      <Heatmap />\n    </div>\n  );\n};\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}