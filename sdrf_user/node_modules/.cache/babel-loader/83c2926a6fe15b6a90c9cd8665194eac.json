{"ast":null,"code":"import _slicedToArray from \"/home/n3op2/node/sdrf_client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/n3op2/node/sdrf_client/src/App.js\";\nimport React, { Fragment, useEffect, useState } from 'react';\nimport * as d3 from 'd3';\nimport axios from 'axios';\n\nconst Heatmap = () => {\n  const _useState = useState(new Date().getTime()),\n        _useState2 = _slicedToArray(_useState, 2),\n        timeDataTaken = _useState2[0],\n        setTimeDataTaken = _useState2[1];\n\n  const _useState3 = useState({}),\n        _useState4 = _slicedToArray(_useState3, 2),\n        lastSample = _useState4[0],\n        setLastSample = _useState4[1];\n\n  const delay = async ms => {\n    await new Promise(resolve => setTimeout(resolve, ms));\n    console.log('after ', ms);\n    setTimeDataTaken(new Date().getTime());\n  };\n\n  useEffect(() => {\n    console.log('useEffect()');\n    const url = 'http://localhost:3010';\n\n    const getData = async () => {\n      axios.get(url).then(res => {\n        console.log('fetching data...'); // TODO have a separate table for data values such as\n        // hzLow, hzHigh and link it with freqs id\n\n        if (res.data) {\n          // TODO tidy up\n          const data = res.data;\n          const baseHz = res.data[0].hzLow;\n          const topHz = res.data[0].hzHigh;\n          const baseTemperature = res.data[0].hzLow;\n          const step = (topHz - baseHz) / res.data[0].freqs.length;\n          let hz = baseHz;\n          const dataVis = [];\n          const mappedData = data.map((el, i) => {\n            console.log('started');\n            hz = baseHz;\n            return el.freqs.map(db => {\n              const tmp = {};\n              tmp.createdAt = el.createdAt;\n              tmp.db = db;\n              tmp.hz = hz;\n              hz = Math.round(hz + step);\n              dataVis.push(tmp);\n              return tmp;\n            });\n          });\n          console.log('top: ', topHz, '\\nbase: ', baseHz);\n          /*\n          if (lastSample === mappedData[mappedData.length - 1]) {\n            delay(1000);\n          }\n          */\n\n          console.log('time taken: ', timeDataTaken);\n          console.log('t: ', dataVis[dataVis.length - 1]);\n          setLastSample(dataVis[1]);\n          delay(3000); // TODO move it to a separate function\n\n          const hzRange = [baseHz, topHz];\n          const margin = {\n            top: 100,\n            right: 50,\n            bottom: 100,\n            left: 50\n          };\n          const width = 9450 - margin.left - margin.right;\n          const height = 950 - margin.top - margin.bottom;\n          const svg = d3.select('.chart').attr('width', width + margin.left + margin.right).attr('height', height + margin.top + margin.bottom).append('g').attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\n          const xScale = d3.scaleBand().range([0, width]).domain(mappedData[0].map(d => {\n            return d.hz;\n          })).padding(0.01);\n          svg.append('g').attr('transform', 'translate(0,' + height + ')').call(d3.axisBottom(xScale).ticks(30, 's')).attr('class', 'xAxis');\n          const yScale = d3.scaleBand().range([height, 0]).domain(mappedData.map(el => el.map(item => item.createdAt).filter((v, i, a) => a.indexOf(v) === i)[0])).padding(0.01);\n          svg.append(\"g\").call(d3.axisLeft(yScale)).attr('class', 'yAxis');\n          svg.append('text').attr('transform', 'translate(' + width / 2 + ',' + (height + 40) + ')').style('text-anchor', 'middle').text('HZ');\n          const colorScale = d3.scaleLinear().range(['blue', 'yellow', 'red']).domain([-127, 0, 127]);\n          svg.selectAll('g.x text').attr('transform', 'translate(-10,10) rotate(315)');\n          svg.selectAll().data(dataVis).enter().append(\"rect\").attr(\"x\", function (d) {\n            return xScale(d.hz);\n          }).attr(\"y\", function (d) {\n            return yScale(d.createdAt);\n          }).attr(\"width\", xScale.bandwidth()).attr(\"height\", yScale.bandwidth()).style(\"fill\", function (d) {\n            return colorScale(d.db);\n          });\n          svg.selectAll('g.x').attr('transform', 'translate(-10,10) rotate(315)');\n        }\n      });\n    };\n  }, ['timeDataTaken']);\n  return React.createElement(Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130\n    },\n    __self: this\n  }, React.createElement(\"h1\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131\n    },\n    __self: this\n  }, \"Heatmap\"), React.createElement(\"svg\", {\n    className: \"chart\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132\n    },\n    __self: this\n  }));\n};\n\nconst App = () => {\n  return React.createElement(\"div\", {\n    style: {\n      height: '100%'\n    },\n    className: \"App\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139\n    },\n    __self: this\n  }, React.createElement(Heatmap, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140\n    },\n    __self: this\n  }));\n};\n\nexport default App;","map":{"version":3,"sources":["/home/n3op2/node/sdrf_client/src/App.js"],"names":["React","Fragment","useEffect","useState","d3","axios","Heatmap","Date","getTime","timeDataTaken","setTimeDataTaken","lastSample","setLastSample","delay","ms","Promise","resolve","setTimeout","console","log","url","getData","get","then","res","data","baseHz","hzLow","topHz","hzHigh","baseTemperature","step","freqs","length","hz","dataVis","mappedData","map","el","i","db","tmp","createdAt","Math","round","push","hzRange","margin","top","right","bottom","left","width","height","svg","select","attr","append","xScale","scaleBand","range","domain","d","padding","call","axisBottom","ticks","yScale","item","filter","v","a","indexOf","axisLeft","style","text","colorScale","scaleLinear","selectAll","enter","bandwidth","App"],"mappings":";;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,QAArC,QAAqD,OAArD;AACA,OAAO,KAAKC,EAAZ,MAAoB,IAApB;AACA,OAAOC,KAAP,MAAkB,OAAlB;;AAEA,MAAMC,OAAO,GAAG,MAAM;AAAA,oBACsBH,QAAQ,CAAC,IAAII,IAAJ,GAAWC,OAAX,EAAD,CAD9B;AAAA;AAAA,QACbC,aADa;AAAA,QACEC,gBADF;;AAAA,qBAEgBP,QAAQ,CAAC,EAAD,CAFxB;AAAA;AAAA,QAEbQ,UAFa;AAAA,QAEDC,aAFC;;AAIpB,QAAMC,KAAK,GAAG,MAAOC,EAAP,IAAc;AAC1B,UAAM,IAAIC,OAAJ,CAAaC,OAAD,IAAaC,UAAU,CAACD,OAAD,EAAUF,EAAV,CAAnC,CAAN;AACAI,IAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBL,EAAtB;AACAJ,IAAAA,gBAAgB,CAAC,IAAIH,IAAJ,GAAWC,OAAX,EAAD,CAAhB;AACD,GAJD;;AAMAN,EAAAA,SAAS,CAAC,MAAM;AACdgB,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ;AACA,UAAMC,GAAG,GAAG,uBAAZ;;AACA,UAAMC,OAAO,GAAG,YAAY;AAC5BhB,MAAAA,KAAK,CAACiB,GAAN,CAAUF,GAAV,EAAeG,IAAf,CAAoBC,GAAG,IAAI;AACzBN,QAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EADyB,CAEzB;AACA;;AACA,YAAIK,GAAG,CAACC,IAAR,EAAc;AACZ;AACA,gBAAMA,IAAI,GAAGD,GAAG,CAACC,IAAjB;AACA,gBAAMC,MAAM,GAAGF,GAAG,CAACC,IAAJ,CAAS,CAAT,EAAYE,KAA3B;AACA,gBAAMC,KAAK,GAAGJ,GAAG,CAACC,IAAJ,CAAS,CAAT,EAAYI,MAA1B;AACA,gBAAMC,eAAe,GAAGN,GAAG,CAACC,IAAJ,CAAS,CAAT,EAAYE,KAApC;AACA,gBAAMI,IAAI,GAAG,CAACH,KAAK,GAAGF,MAAT,IAAmBF,GAAG,CAACC,IAAJ,CAAS,CAAT,EAAYO,KAAZ,CAAkBC,MAAlD;AACA,cAAIC,EAAE,GAAGR,MAAT;AACA,gBAAMS,OAAO,GAAG,EAAhB;AAEA,gBAAMC,UAAU,GAAGX,IAAI,CAACY,GAAL,CAAS,CAACC,EAAD,EAAKC,CAAL,KAAW;AACrCrB,YAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ;AACAe,YAAAA,EAAE,GAAGR,MAAL;AACA,mBAAOY,EAAE,CAACN,KAAH,CAASK,GAAT,CAAcG,EAAD,IAAQ;AAC1B,oBAAMC,GAAG,GAAG,EAAZ;AACAA,cAAAA,GAAG,CAACC,SAAJ,GAAgBJ,EAAE,CAACI,SAAnB;AACAD,cAAAA,GAAG,CAACD,EAAJ,GAASA,EAAT;AACAC,cAAAA,GAAG,CAACP,EAAJ,GAASA,EAAT;AACAA,cAAAA,EAAE,GAAGS,IAAI,CAACC,KAAL,CAAWV,EAAE,GAAGH,IAAhB,CAAL;AACAI,cAAAA,OAAO,CAACU,IAAR,CAAaJ,GAAb;AACA,qBAAOA,GAAP;AACD,aARM,CAAP;AASD,WAZkB,CAAnB;AAcAvB,UAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBS,KAArB,EAA4B,UAA5B,EAAwCF,MAAxC;AAEA;;;;;;AAMAR,UAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA4BV,aAA5B;AACAS,UAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ,EAAmBgB,OAAO,CAACA,OAAO,CAACF,MAAR,GAAgB,CAAjB,CAA1B;AACArB,UAAAA,aAAa,CAACuB,OAAO,CAAC,CAAD,CAAR,CAAb;AACAtB,UAAAA,KAAK,CAAC,IAAD,CAAL,CAnCY,CAqCZ;;AACA,gBAAMiC,OAAO,GAAG,CAACpB,MAAD,EAASE,KAAT,CAAhB;AACA,gBAAMmB,MAAM,GAAG;AAACC,YAAAA,GAAG,EAAE,GAAN;AAAWC,YAAAA,KAAK,EAAE,EAAlB;AAAsBC,YAAAA,MAAM,EAAE,GAA9B;AAAmCC,YAAAA,IAAI,EAAE;AAAzC,WAAf;AACA,gBAAMC,KAAK,GAAG,OAAOL,MAAM,CAACI,IAAd,GAAqBJ,MAAM,CAACE,KAA1C;AACA,gBAAMI,MAAM,GAAG,MAAMN,MAAM,CAACC,GAAb,GAAmBD,MAAM,CAACG,MAAzC;AAEA,gBAAMI,GAAG,GAAGlD,EAAE,CAACmD,MAAH,CAAU,QAAV,EACTC,IADS,CACJ,OADI,EACKJ,KAAK,GAAGL,MAAM,CAACI,IAAf,GAAsBJ,MAAM,CAACE,KADlC,EAETO,IAFS,CAEJ,QAFI,EAEMH,MAAM,GAAGN,MAAM,CAACC,GAAhB,GAAsBD,MAAM,CAACG,MAFnC,EAGTO,MAHS,CAGF,GAHE,EAITD,IAJS,CAIJ,WAJI,EAIS,eAAeT,MAAM,CAACI,IAAtB,GAA6B,GAA7B,GAAmCJ,MAAM,CAACC,GAA1C,GAAgD,GAJzD,CAAZ;AAMA,gBAAMU,MAAM,GAAGtD,EAAE,CAACuD,SAAH,GACZC,KADY,CACN,CAAC,CAAD,EAAIR,KAAJ,CADM,EAEZS,MAFY,CAELzB,UAAU,CAAC,CAAD,CAAV,CAAcC,GAAd,CAAkByB,CAAC,IAAI;AAC7B,mBAAOA,CAAC,CAAC5B,EAAT;AACD,WAFO,CAFK,EAKZ6B,OALY,CAKJ,IALI,CAAf;AAOAT,UAAAA,GAAG,CAACG,MAAJ,CAAW,GAAX,EACGD,IADH,CACQ,WADR,EACqB,iBAAiBH,MAAjB,GAA0B,GAD/C,EAEGW,IAFH,CAEQ5D,EAAE,CAAC6D,UAAH,CAAcP,MAAd,EACHQ,KADG,CACG,EADH,EACO,GADP,CAFR,EAIGV,IAJH,CAIQ,OAJR,EAIgB,OAJhB;AAOA,gBAAMW,MAAM,GAAG/D,EAAE,CAACuD,SAAH,GACZC,KADY,CACN,CAAEP,MAAF,EAAU,CAAV,CADM,EAEZQ,MAFY,CAELzB,UAAU,CAACC,GAAX,CAAgBC,EAAD,IAAQA,EAAE,CAACD,GAAH,CAAQ+B,IAAD,IAAUA,IAAI,CAAC1B,SAAtB,EAC5B2B,MAD4B,CACrB,CAACC,CAAD,EAAI/B,CAAJ,EAAOgC,CAAP,KAAaA,CAAC,CAACC,OAAF,CAAUF,CAAV,MAAiB/B,CADT,EACY,CADZ,CAAvB,CAFK,EAIZwB,OAJY,CAIJ,IAJI,CAAf;AAMAT,UAAAA,GAAG,CAACG,MAAJ,CAAW,GAAX,EACGO,IADH,CACQ5D,EAAE,CAACqE,QAAH,CAAYN,MAAZ,CADR,EAEGX,IAFH,CAEQ,OAFR,EAEgB,OAFhB;AAIAF,UAAAA,GAAG,CAACG,MAAJ,CAAW,MAAX,EACGD,IADH,CACQ,WADR,EACoB,eAAgBJ,KAAK,GAAG,CAAxB,GAA6B,GAA7B,IAAoCC,MAAM,GAAG,EAA7C,IAAmD,GADvE,EAEGqB,KAFH,CAES,aAFT,EAEuB,QAFvB,EAGGC,IAHH,CAGQ,IAHR;AAKA,gBAAMC,UAAU,GAAGxE,EAAE,CAACyE,WAAH,GAChBjB,KADgB,CACV,CAAC,MAAD,EAAS,QAAT,EAAmB,KAAnB,CADU,EAEhBC,MAFgB,CAET,CAAC,CAAC,GAAF,EAAO,CAAP,EAAU,GAAV,CAFS,CAAnB;AAIAP,UAAAA,GAAG,CAACwB,SAAJ,CAAc,UAAd,EACGtB,IADH,CACQ,WADR,EACqB,+BADrB;AAGAF,UAAAA,GAAG,CAACwB,SAAJ,GACKrD,IADL,CACUU,OADV,EAEK4C,KAFL,GAGKtB,MAHL,CAGY,MAHZ,EAIKD,IAJL,CAIU,GAJV,EAIe,UAASM,CAAT,EAAY;AACrB,mBAAOJ,MAAM,CAACI,CAAC,CAAC5B,EAAH,CAAb;AACD,WANL,EAOKsB,IAPL,CAOU,GAPV,EAOe,UAASM,CAAT,EAAY;AACrB,mBAAOK,MAAM,CAACL,CAAC,CAACpB,SAAH,CAAb;AACD,WATL,EAUKc,IAVL,CAUU,OAVV,EAUmBE,MAAM,CAACsB,SAAP,EAVnB,EAWKxB,IAXL,CAWU,QAXV,EAWoBW,MAAM,CAACa,SAAP,EAXpB,EAYKN,KAZL,CAYW,MAZX,EAYmB,UAASZ,CAAT,EAAY;AAAE,mBAAOc,UAAU,CAACd,CAAC,CAACtB,EAAH,CAAjB;AAAwB,WAZzD;AAcAc,UAAAA,GAAG,CAACwB,SAAJ,CAAc,KAAd,EACGtB,IADH,CACQ,WADR,EACqB,+BADrB;AAED;AACF,OA1GD;AA2GC,KA5GD;AA6GD,GAhHQ,EAgHN,CAAC,eAAD,CAhHM,CAAT;AAkHA,SACE,oBAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eADF,EAEE;AAAK,IAAA,SAAS,EAAC,OAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFF,CADF;AAMD,CAlID;;AAoIA,MAAMyB,GAAG,GAAG,MAAM;AAChB,SACE;AAAK,IAAA,KAAK,EAAE;AAAC5B,MAAAA,MAAM,EAAE;AAAT,KAAZ;AAA8B,IAAA,SAAS,EAAC,KAAxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,OAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CADF;AAKD,CAND;;AAQA,eAAe4B,GAAf","sourcesContent":["import React, { Fragment, useEffect, useState } from 'react';\nimport * as d3 from 'd3';\nimport axios from 'axios';\n\nconst Heatmap = () => {\n  const [timeDataTaken, setTimeDataTaken] = useState(new Date().getTime());\n  const [lastSample, setLastSample] = useState({});\n   \n  const delay = async (ms) => {\n    await new Promise((resolve) => setTimeout(resolve, ms));\n    console.log('after ', ms);\n    setTimeDataTaken(new Date().getTime());\n  };\n\n  useEffect(() => {\n    console.log('useEffect()');\n    const url = 'http://localhost:3010';\n    const getData = async () => {\n    axios.get(url).then(res => {\n      console.log('fetching data...');\n      // TODO have a separate table for data values such as\n      // hzLow, hzHigh and link it with freqs id\n      if (res.data) {\n        // TODO tidy up\n        const data = res.data;\n        const baseHz = res.data[0].hzLow;\n        const topHz = res.data[0].hzHigh;\n        const baseTemperature = res.data[0].hzLow;\n        const step = (topHz - baseHz) / res.data[0].freqs.length;\n        let hz = baseHz;\n        const dataVis = [];\n\n        const mappedData = data.map((el, i) => {\n          console.log('started');\n          hz = baseHz;\n          return el.freqs.map((db) => {\n            const tmp = {};\n            tmp.createdAt = el.createdAt;\n            tmp.db = db;\n            tmp.hz = hz;\n            hz = Math.round(hz + step);\n            dataVis.push(tmp);\n            return tmp;\n          });\n        });\n\n        console.log('top: ', topHz, '\\nbase: ', baseHz);\n\n        /*\n        if (lastSample === mappedData[mappedData.length - 1]) {\n          delay(1000);\n        }\n        */\n\n        console.log('time taken: ', timeDataTaken);\n        console.log('t: ', dataVis[dataVis.length -1]);\n        setLastSample(dataVis[1]);\n        delay(3000);\n\n        // TODO move it to a separate function\n        const hzRange = [baseHz, topHz]; \n        const margin = {top: 100, right: 50, bottom: 100, left: 50};\n        const width = 9450 - margin.left - margin.right;\n        const height = 950 - margin.top - margin.bottom;\n\n        const svg = d3.select('.chart')\n          .attr('width', width + margin.left + margin.right)\n          .attr('height', height + margin.top + margin.bottom)\n          .append('g')\n          .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\n\n        const xScale = d3.scaleBand()\n          .range([0, width])\n          .domain(mappedData[0].map(d => {\n            return d.hz;\n          }))\n          .padding(0.01);\n\n        svg.append('g')\n          .attr('transform', 'translate(0,' + height + ')')\n          .call(d3.axisBottom(xScale)\n            .ticks(30, 's'))\n          .attr('class','xAxis');\n\n\n        const yScale = d3.scaleBand()\n          .range([ height, 0 ])\n          .domain(mappedData.map((el) => el.map((item) => item.createdAt)\n            .filter((v, i, a) => a.indexOf(v) === i)[0]))\n          .padding(0.01);\n\n        svg.append(\"g\")\n          .call(d3.axisLeft(yScale))\n          .attr('class','yAxis');\n\n        svg.append('text')\n          .attr('transform','translate(' + (width / 2) + ',' + (height + 40) + ')')\n          .style('text-anchor','middle')\n          .text('HZ');\n\n        const colorScale = d3.scaleLinear()\n          .range(['blue', 'yellow', 'red'])\n          .domain([-127, 0, 127]);\n        \n        svg.selectAll('g.x text')\n          .attr('transform', 'translate(-10,10) rotate(315)');\n\n        svg.selectAll()\n            .data(dataVis)\n            .enter()\n            .append(\"rect\")\n            .attr(\"x\", function(d) { \n              return xScale(d.hz) \n            })\n            .attr(\"y\", function(d) { \n              return yScale(d.createdAt) \n            })\n            .attr(\"width\", xScale.bandwidth() )\n            .attr(\"height\", yScale.bandwidth() )\n            .style(\"fill\", function(d) { return colorScale(d.db)} )\n      \n        svg.selectAll('g.x')\n          .attr('transform', 'translate(-10,10) rotate(315)');\n      }\n    });\n    };\n  }, ['timeDataTaken']);\n\n  return (\n    <Fragment>\n      <h1>Heatmap</h1>\n      <svg className='chart'></svg>\n    </Fragment>\n  );\n};\n\nconst App = () => {\n  return (\n    <div style={{height: '100%'}} className=\"App\">\n      <Heatmap />\n    </div>\n  );\n};\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}