{"ast":null,"code":"import _slicedToArray from \"/home/n3op2/node/sdrf_client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/n3op2/node/sdrf_client/src/App.js\";\nimport React, { Fragment, useEffect, useState } from 'react';\nimport * as d3 from 'd3';\nimport axios from 'axios';\n\nconst Heatmap = () => {\n  const _useState = useState({}),\n        _useState2 = _slicedToArray(_useState, 2),\n        samples = _useState2[0],\n        setSamples = _useState2[1];\n\n  const _useState3 = useState([]),\n        _useState4 = _slicedToArray(_useState3, 2),\n        mappedData = _useState4[0],\n        setMappedData = _useState4[1]; // D3 stuff \n\n\n  const margin = {\n    top: 100,\n    right: 50,\n    bottom: 100,\n    left: 50\n  };\n  const width = 9450 - margin.left - margin.right;\n  const height = 1250 - margin.top - margin.bottom;\n  const svg = d3.select('.chart').attr('width', width + margin.left + margin.right).attr('height', height + margin.top + margin.bottom).append('g').attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\n  const url = 'http://localhost:3010';\n\n  const getData = async () => {\n    const res = await axios.get(url);\n    const data = res.data;\n    const baseHz = res.data[0].hzLow;\n    const topHz = res.data[0].hzHigh;\n    const step = (topHz - baseHz) / res.data[0].freqs.length;\n    let hz = baseHz;\n    const dataVis = [];\n    setMappedData(data.map((el, i) => {\n      hz = baseHz;\n      return el.freqs.map(db => {\n        const tmp = {};\n        tmp.createdAt = el.createdAt;\n        tmp.db = db;\n        tmp.hz = hz;\n        hz = Math.round(hz + step);\n        dataVis.push(tmp);\n        return tmp;\n      });\n    }));\n    svg.append('g').attr('transform', 'translate(0,' + height + ')').call(d3.axisBottom(xScale).ticks(30, 's')).attr('class', 'xAxis');\n    const yScale = d3.scaleBand().range([height, 0]).domain(mappedData.map(el => el.map(item => item.createdAt).filter((v, i, a) => a.indexOf(v) === i)[0])).padding(0.01);\n    svg.append(\"g\").call(d3.axisLeft(yScale)).attr('class', 'yAxis');\n    svg.append('text').attr('transform', 'translate(' + width / 2 + ',' + (height + 40) + ')').style('text-anchor', 'middle').text('HZ');\n    const colorScale = d3.scaleLinear().range(['blue', 'yellow', 'red']).domain([-127, 0, 127]);\n    svg.selectAll('g.x text').attr('transform', 'translate(-10,10) rotate(315)');\n    svg.selectAll().data(dataVis).enter().append(\"rect\").attr(\"x\", function (d) {\n      return xScale(d.hz);\n    }).attr(\"y\", function (d) {\n      return yScale(d.createdAt);\n    }).attr(\"width\", xScale.bandwidth()).attr(\"height\", yScale.bandwidth()).style(\"fill\", function (d) {\n      return colorScale(d.db);\n    });\n    svg.selectAll('g.x').attr('transform', 'translate(-10,10) rotate(315)');\n    await new Promise(r => setTimeout(r, 3000));\n    return getData();\n  };\n\n  useEffect(() => {\n    const wsClient = new WebSocket('ws://localhost:8080');\n\n    wsClient.onopen = () => {\n      console.log('ws connected');\n    };\n\n    wsClient.onopen = () => {\n      console.log('ws connected');\n    };\n\n    wsClient.onmessage = msg => {\n      console.log('msg received: ', msg);\n    };\n\n    getData();\n  }, []); // D3 stuff, move to another componet\n\n  const xScale = d3.scaleBand().range([0, width]).domain(mappedData[0].map(d => {\n    return d.hz;\n  })).padding(0.01);\n  return React.createElement(Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117\n    },\n    __self: this\n  }, React.createElement(\"svg\", {\n    className: \"chart\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  }));\n};\n\nconst App = () => {\n  return React.createElement(\"div\", {\n    style: {\n      height: '100%'\n    },\n    className: \"App\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125\n    },\n    __self: this\n  }, React.createElement(Heatmap, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126\n    },\n    __self: this\n  }));\n};\n\nexport default App;","map":{"version":3,"sources":["/home/n3op2/node/sdrf_client/src/App.js"],"names":["React","Fragment","useEffect","useState","d3","axios","Heatmap","samples","setSamples","mappedData","setMappedData","margin","top","right","bottom","left","width","height","svg","select","attr","append","url","getData","res","get","data","baseHz","hzLow","topHz","hzHigh","step","freqs","length","hz","dataVis","map","el","i","db","tmp","createdAt","Math","round","push","call","axisBottom","xScale","ticks","yScale","scaleBand","range","domain","item","filter","v","a","indexOf","padding","axisLeft","style","text","colorScale","scaleLinear","selectAll","enter","d","bandwidth","Promise","r","setTimeout","wsClient","WebSocket","onopen","console","log","onmessage","msg","App"],"mappings":"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","sourcesContent":["import React, { Fragment, useEffect, useState } from 'react';\nimport * as d3 from 'd3';\nimport axios from 'axios';\n\nconst Heatmap = () => {\n  const [samples, setSamples] = useState({});\n  const [mappedData, setMappedData] = useState([]);\n\n  // D3 stuff \n  const margin = {top: 100, right: 50, bottom: 100, left: 50};\n  const width = 9450 - margin.left - margin.right;\n  const height = 1250 - margin.top - margin.bottom;\n\n  const svg = d3.select('.chart')\n    .attr('width', width + margin.left + margin.right)\n    .attr('height', height + margin.top + margin.bottom)\n    .append('g')\n    .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\n\n  const url = 'http://localhost:3010';\n  const getData = async () => {\n    const res = await axios.get(url);\n    const data = res.data;\n    const baseHz = res.data[0].hzLow;\n    const topHz = res.data[0].hzHigh;\n    const step = (topHz - baseHz) / res.data[0].freqs.length;\n    let hz = baseHz;\n    const dataVis = [];\n    setMappedData(data.map((el, i) => {\n      hz = baseHz;\n      return el.freqs.map((db) => {\n        const tmp = {};\n        tmp.createdAt = el.createdAt;\n        tmp.db = db;\n        tmp.hz = hz;\n        hz = Math.round(hz + step);\n        dataVis.push(tmp);\n        return tmp;\n      });\n    }));\n\n    svg.append('g')\n      .attr('transform', 'translate(0,' + height + ')')\n      .call(d3.axisBottom(xScale)\n        .ticks(30, 's'))\n      .attr('class','xAxis');\n\n\n    const yScale = d3.scaleBand()\n      .range([ height, 0 ])\n      .domain(mappedData.map((el) => el.map((item) => item.createdAt)\n        .filter((v, i, a) => a.indexOf(v) === i)[0]))\n      .padding(0.01);\n\n    svg.append(\"g\")\n      .call(d3.axisLeft(yScale))\n      .attr('class','yAxis');\n\n    svg.append('text')\n      .attr('transform','translate(' + (width / 2) + ',' + (height + 40) + ')')\n      .style('text-anchor','middle')\n      .text('HZ');\n\n    const colorScale = d3.scaleLinear()\n      .range(['blue', 'yellow', 'red'])\n      .domain([-127, 0, 127]);\n\n    svg.selectAll('g.x text')\n      .attr('transform', 'translate(-10,10) rotate(315)');\n\n    svg.selectAll()\n        .data(dataVis)\n        .enter()\n        .append(\"rect\")\n        .attr(\"x\", function(d) {\n          return xScale(d.hz)\n        })\n        .attr(\"y\", function(d) {\n          return yScale(d.createdAt)\n        })\n        .attr(\"width\", xScale.bandwidth() )\n        .attr(\"height\", yScale.bandwidth() )\n        .style(\"fill\", function(d) { return colorScale(d.db)} )\n\n    svg.selectAll('g.x')\n      .attr('transform', 'translate(-10,10) rotate(315)');\n\n    await new Promise((r) => setTimeout(r, 3000));\n    return getData();\n  };\n\n  useEffect(() => {\n    const wsClient = new WebSocket('ws://localhost:8080');\n    wsClient.onopen = () => {\n      console.log('ws connected');\n    }\n    wsClient.onopen = () => {\n      console.log('ws connected');\n    }\n    wsClient.onmessage = (msg) => {\n      console.log('msg received: ', msg);\n    }\n    getData();\n  }, []);\n\n  // D3 stuff, move to another componet\n\n  const xScale = d3.scaleBand()\n    .range([0, width])\n    .domain(mappedData[0].map(d => {\n      return d.hz;\n    }))\n    .padding(0.01);\n\n\n  return (\n    <Fragment>\n      <svg className='chart'></svg>\n    </Fragment>\n  );\n};\n\nconst App = () => {\n  return (\n    <div style={{height: '100%'}} className=\"App\">\n      <Heatmap />\n    </div>\n  );\n};\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}